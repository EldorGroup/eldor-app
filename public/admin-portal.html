<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ניהול מערכת - Eldor Group</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f8fafc; margin: 0; padding: 20px; }
        .header { display: flex; justify-content: space-between; align-items: center; background: #1e293b; color: white; padding: 15px 30px; border-radius: 8px; margin-bottom: 20px; }
        .logout-btn { background: #f87171; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; }
        .container { background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h2 { color: #1e293b; border-bottom: 2px solid #fbbf24; padding-bottom: 10px; }
        input, select { padding: 10px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; }
        button.add-btn { background: #10b981; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: right; }
        th { background: #f1f5f9; }
        .delete-btn { background: #ef4444; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; }
    </style>
</head>
<body>

<script>
    // בדיקת אבטחה - אם לא מחובר, שלח ללוגין
    if (localStorage.getItem('adminLoggedIn') !== 'true') {
        window.location.href = '/login.html';
    }

    function logout() {
        localStorage.removeItem('adminLoggedIn');
        window.location.href = '/login.html';
    }
</script>

<div class="header">
    <h1>Eldor Group - פאנל ניהול</h1>
    <button class="logout-btn" onclick="logout()">התנתק</button>
</div>

<div class="container">
    <h2>הוספת/עדכון לקוח</h2>
    <input type="text" id="clientName" placeholder="שם לקוח">
    <input type="text" id="clientPhone" placeholder="מספר טלפון">
    <input type="text" id="clientBalance" placeholder="יתרה (₪)">
    <input type="text" id="clientProfit" placeholder="רווח יומי (%)">
    <input type="text" id="clientRoute" placeholder="מסלול השקעה">
    <input type="text" id="clientCode" placeholder="קוד כניסה">
    <button class="add-btn" onclick="addClient()">שמור לקוח</button>
</div>

<div class="container">
    <h2>רשימת לקוחות</h2>
    <table id="clientsTable">
        <thead>
            <tr>
                <th>שם</th>
                <th>טלפון</th>
                <th>יתרה</th>
                <th>רווח</th>
                <th>מסלול</th>
                <th>קוד</th>
                <th>פעולות</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<div class="container">
    <h2>לידים חדשים (צור קשר)</h2>
    <table id="leadsTable">
        <thead>
            <tr>
                <th>שם</th>
                <th>טלפון</th>
                <th>תאריך</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
    async function loadData() {
        const res = await fetch('/api/admin/data');
        const data = await res.json();
        
        // טעינת לקוחות
        const clientsBody = document.querySelector('#clientsTable tbody');
        clientsBody.innerHTML = '';
        data.clients.forEach(c => {
            clientsBody.innerHTML += `
                <tr>
                    <td>${c.name}</td>
                    <td>${c.phone}</td>
                    <td>${c.balance}</td>
                    <td>${c.profit}</td>
                    <td>${c.route}</td>
                    <td>${c.code}</td>
                    <td><button class="delete-btn" onclick="deleteClient('${c.phone}')">מחק</button></td>
                </tr>
            `;
        });

        // טעינת לידים
        const leadsBody = document.querySelector('#leadsTable tbody');
        leadsBody.innerHTML = '';
        data.leads.forEach(l => {
            leadsBody.innerHTML += `<tr><td>${l.name}</td><td>${l.phone}</td><td>${l.date}</td></tr>`;
        });
    }

    async function addClient() {
        const client = {
            name: document.getElementById('clientName').value,
            phone: document.getElementById('clientPhone').value,
            balance: document.getElementById('clientBalance').value,
            profit: document.getElementById('clientProfit').value,
            route: document.getElementById('clientRoute').value,
            code: document.getElementById('clientCode').value
        };
        await fetch('/api/admin/add-client', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(client)
        });
        location.reload();
    }

    async function deleteClient(phone) {
        if(confirm('למחוק את הלקוח?')) {
            await fetch('/api/admin/delete-client', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ phone })
            });
            location.reload();
        }
    }

    loadData();
</script>

</body>
</html>
